---
title: '输入输出管理'
date: 2020-05-03 18:53:56
tags: [Operating System]
published: true
hideInList: false
feature: /post-images/shu-ru-shu-chu-guan-li.jpg
isTop: false
---
# I/O管理概述

## I/O控制器

* 主要功能
    * 接受和识别CPU发出的命令（要有控制寄存器）
    * 想CPU报告设备的状态（要有状态寄存器）
    * 数据交换（要有数据寄存器，暂存输入/输出的数据）
    * 地址识别（I/O逻辑实现）
* 组成
    * CPU与控制器之间的接口（实现控制器与CPU之间的通信）
    * I/O逻辑（负责识别CPU发出的命令，并向设备发出命令）
    * 控制器与设备之间的接口（实现控制器与设备之间的通信）
* 两种寄存器编址方式
    * 内存映射I/O
        * 控制器中的寄存器与内存统一编制
        * 可以采用对内存进行操作的指令来对控制器进行操作
    * 寄存器独立编制
        * 控制器中的寄存器独立编制
        * 需要设置专门的指令来操作控制器

## IO软件层次

* 用户层软件：与用户交互，向上提供库函数
* 设备独立性软件
    * 向上提供调用接口，系统调用
    * 设备的保护
    * 差错处理
    * 设备的分配与回收
    * 数据缓冲区处理
    * 建立逻辑设备名到物理设备名的映射关系
* 设备驱动程序：设置设备寄存器、检查设备状态
* 中断处理程序：进行中断处理
* 硬件：执行I/O操作

## I/O控制方式

* 程序直接控制方式
* 中断驱动方式
* DMA方式
* 通道控制方式

## I/O核心子系统

* I/O调度：设备独立性软件实现
* 设备保护：设备独立性软件实现
* 假脱机技术（SPOOLing）：用户层软件实现
* 设备分配与回收：设备独立性软件实现
* 缓冲区管理：设备独立性软件实现

## 假脱机技术

* 脱机技术
    * 外围控制机+更高速的设备--磁带
    * 作用：环节设备与CPU的速度矛盾，实现预输入、缓输出
* 假脱机技术
    * 又叫SPOOLing技术，用软件方式模拟脱机技术
    * 输入井和输出井--模拟脱机输入输出i的磁带
    * 输入进程和输出进程--模拟脱机输入输出是的外围控制机
    * 输入缓冲区和输出缓冲区--内存中的缓冲区，输入、输出是的中转站
* 共享打印机
    * 用SPOOLing技术将独占式的打印机“虚拟”成共享打印机

## 设备分配与回收

* 应考虑因素
    * 固有属性：独占设备、共享设备、虚拟设备
    * 分配计算法：先来先服务、优先级高者优先、短任务优先
    * 安全性：安全分配方式、不安全分配方式
* 静态分配与动态分配
    * 静态分配：进程运行前为其分配全部所需资源，运行结束后规划你自愿
    * 动态分配：进程运行过程中动态申请设备资源
* 设备分配管理中的数据结构
    * 设备控制表（DCT）:每个设备对应一张DCT
        * 关键字段：类型/标识符/状态/指向COCT指针/等待队列指针
    * 控制器控制表（COCT）：每个控制器对应于一张COCT
        * 关键字段：状态/指向CHCT的指针/等待队列指针
    * 通道控制表（CHCT）：每个控制器对应一张CHCT
        * 关键字段：状态/等待队列指针
    * 系统设备表（SDT）：记录整个系统中所有设备的情况，每个设备对应一个表目
        * 关键字段：设备类型/标识符/DCT/驱动程序入口
* 设备分配步骤
    * 根据进程请求的物理设备名查找SDT
    * 根据SDT找到DCT并分配设备
    * 根据DCT找到COCT并分配控制器
    * 根据COCT找到CHCT并分配通道
    * 注：只有设备、控制器、通道三者都配对成功才算分配成功，之后便可以启动IO设备进行数据传输
    * 缺点：用户编程时必须使用“物理设备名”若换了一个物理设备，则程序无法运行。若进程请求的物理设备正在忙碌，则即使系统中还有同类型的设备，进程也必须阻塞等待
* 设备分配步骤的改进
    * 用户编程时使用逻辑设备名申请设备，操作系统负责实现从逻辑设备到物理设备名的映射（通过LUT）
    * 逻辑设备表的设置问题
        * 整个系统只有一张LUT：各个用户所用的逻辑设备不允许重复
        * 每个用户一行LUT：各个用户的逻辑设备名可以重复

## 缓冲区管理

* 缓冲区的概念
    * 一般利用内存作为缓冲区
    * 环节CPU与设备的速度矛盾、减少对CPU的中断频率、解决数据粒度不匹配的问题、提高CPU与I/O设备之间的并行性
* 单缓冲
    * 设备—（T）—缓冲区—（M）—工作区—（C）—处理
    * 处理一块数据平均耗时Max(C,T)+M
    * 分析问题的初始状态：工作区满，缓冲区空
* 双缓冲
    * 处理一块数据平均耗时Max(T,C+M)
    * 分析问题的初始状态：工作区空，一个缓冲区满，另一个缓冲区空
* 循环缓冲：多个缓冲区链接成循环队列，in指针指向第一个空缓冲区，out指针指向第一个满缓冲区
* 缓冲池
    * 三个队列：空缓冲队列、输入队列、输出队列
    * 四种工作缓冲区
        * 用于收容输入数据的工作缓冲区，用于提取输入数据的工作缓冲区
        * 用户收容输出数据的工作缓冲区，用于提取输出数据的工作缓冲区